<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-K.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-K.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-K.png">
  <link rel="mask-icon" href="/images/logo-K.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="本笔记源自黑马程序员的视频课程——《瑞吉外卖》，总结了课程笔记、相关知识点以及可能遇到的问题解决方案，并且增加了课程中未实现的功能，供读者参考。笔记全面且条理清晰，希望帮助读者学习和理解这个外卖项目。本项目全部笔记见：外卖项目笔记合集 1. 套餐管理业务开发1.1 新增套餐1.1.1 需求分析套餐就是菜品的集合。 后台系统中可以管理套餐信息，通过”新增套餐”功能来添加一个新的套餐，在添加套餐时，需">
<meta property="og:type" content="article">
<meta property="og:title" content="瑞吉外卖05-套餐管理">
<meta property="og:url" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="Kathy&#39;s Blog">
<meta property="og:description" content="本笔记源自黑马程序员的视频课程——《瑞吉外卖》，总结了课程笔记、相关知识点以及可能遇到的问题解决方案，并且增加了课程中未实现的功能，供读者参考。笔记全面且条理清晰，希望帮助读者学习和理解这个外卖项目。本项目全部笔记见：外卖项目笔记合集 1. 套餐管理业务开发1.1 新增套餐1.1.1 需求分析套餐就是菜品的集合。 后台系统中可以管理套餐信息，通过”新增套餐”功能来添加一个新的套餐，在添加套餐时，需">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/1.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/2.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/3.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/4.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/5.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/6.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/7.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/8.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/9.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/10.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/11.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/12.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/13.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/14.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/15.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/16.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/17.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/18.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/19.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/20.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/21.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/22.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/23.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/24.png">
<meta property="og:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/25.png">
<meta property="article:published_time" content="2023-05-14T03:27:01.000Z">
<meta property="article:modified_time" content="2023-11-21T02:59:29.171Z">
<meta property="article:author" content="Kathy-kx">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="项目笔记">
<meta property="article:tag" content="java">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Spring MVC">
<meta property="article:tag" content="MyBatis">
<meta property="article:tag" content="html">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="DTO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/1.png">


<link rel="canonical" href="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/","path":"2023/05/13/瑞吉外卖05-套餐管理/","title":"瑞吉外卖05-套餐管理"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>瑞吉外卖05-套餐管理 | Kathy's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Kathy's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91"><span class="nav-text">1. 套餐管理业务开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="nav-text">1.1 新增套餐</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text">1.1.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-text">1.1.2 数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-3-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-text">1.1.3 准备工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-4-%E6%A2%B3%E7%90%86%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B%E5%8F%8A%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-text">1.1.4 梳理交互过程及代码开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%A5%97%E9%A4%90%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="nav-text">1.2 套餐分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text">1.2.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-%E6%A2%B3%E7%90%86%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B"><span class="nav-text">1.2.2 梳理交互过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-text">1.2.3 代码开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E5%88%A0%E9%99%A4%E5%A5%97%E9%A4%90%EF%BC%88%E5%90%AB%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="nav-text">1.3 删除套餐（含批量操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text">1.3.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-%E6%A2%B3%E7%90%86%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B"><span class="nav-text">1.3.2 梳理交互过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-text">1.3.3 代码开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E5%90%AF%E5%94%AE-x2F-%E5%81%9C%E5%94%AE%E5%A5%97%E9%A4%90%EF%BC%88%E5%90%AB%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="nav-text">1.4 启售&#x2F;停售套餐（含批量操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text">1.4.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-2-%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-text">1.4.2 代码开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-%E4%BF%AE%E6%94%B9%E5%A5%97%E9%A4%90"><span class="nav-text">1.5 修改套餐</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text">1.5.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-2-%E6%A2%B3%E7%90%86%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B"><span class="nav-text">1.5.2 梳理交互过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-3-%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-text">1.5.3 代码开发</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E5%BD%95"><span class="nav-text">2. 手机验证码登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81"><span class="nav-text">2.1 短信发送</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="nav-text">2.1.1 短信服务介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1-%E4%BB%8B%E7%BB%8D"><span class="nav-text">2.1.2 阿里云短信服务-介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1-%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7"><span class="nav-text">2.1.3 阿里云短信服务-注册账号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-4-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1-%E8%AE%BE%E7%BD%AE%E7%9F%AD%E4%BF%A1%E7%AD%BE%E5%90%8D"><span class="nav-text">2.1.4 阿里云短信服务-设置短信签名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-5-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1-%E8%AE%BE%E7%BD%AE%E7%9F%AD%E4%BF%A1%E6%A8%A1%E6%9D%BF"><span class="nav-text">2.1.5 阿里云短信服务-设置短信模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-6-%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1-%E8%AE%BE%E7%BD%AEAccessKey"><span class="nav-text">2.1.6 阿里云短信服务-设置AccessKey</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-7-%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-text">2.1.7 代码开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E5%BD%95"><span class="nav-text">2.2 手机验证码登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text">2.2.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-text">2.2.2 数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-%E6%A2%B3%E7%90%86%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B"><span class="nav-text">2.2.3 梳理交互过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-4-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-text">2.2.4 准备工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-5-%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="nav-text">2.2.5 代码开发</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Kathy-kx</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/kathy-kx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kathy-kx" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kzhu011@uottawa.ca" title="E-Mail → mailto:kzhu011@uottawa.ca" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Kathy-kx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kathy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="瑞吉外卖05-套餐管理 | Kathy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          瑞吉外卖05-套餐管理
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-05-13 23:27:01" itemprop="dateCreated datePublished" datetime="2023-05-13T23:27:01-04:00">2023-05-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-11-20 21:59:29" itemprop="dateModified" datetime="2023-11-20T21:59:29-05:00">2023-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Food-Delivery-System/" itemprop="url" rel="index"><span itemprop="name">Food Delivery System</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>本笔记源自黑马程序员的视频课程——《瑞吉外卖》，总结了<strong>课程笔记</strong>、相关<strong>知识点</strong>以及可能遇到的<strong>问题解决方案</strong>，并且<strong>增加了课程中未实现的功能</strong>，供读者参考。笔记全面且条理清晰，希望帮助读者学习和理解这个外卖项目。<br>本项目全部笔记见：<a target="_blank" rel="noopener" href="https://kathy-kx.github.io/categories/Food-Delivery-System/">外卖项目笔记合集</a></p>
<h1 id="1-套餐管理业务开发"><a href="#1-套餐管理业务开发" class="headerlink" title="1. 套餐管理业务开发"></a>1. <strong><strong>套餐管理业务开发</strong></strong></h1><h2 id="1-1-新增套餐"><a href="#1-1-新增套餐" class="headerlink" title="1.1 新增套餐"></a>1.1 <strong><strong>新增套餐</strong></strong></h2><h3 id="1-1-1-需求分析"><a href="#1-1-1-需求分析" class="headerlink" title="1.1.1 需求分析"></a>1.1.1 需求分析</h3><p>套餐就是菜品的集合。</p>
<p>后台系统中可以管理套餐信息，通过”新增套餐”功能来添加一个新的套餐，在添加套餐时，需要选择当前套餐所属的套餐分类和包含的菜品，并且需要上传套餐对应的图片，在移动端会按照套餐分类来展示对应的套餐。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/1.png" alt="图片"></p>
<h3 id="1-1-2-数据模型"><a href="#1-1-2-数据模型" class="headerlink" title="1.1.2 数据模型"></a>1.1.2 <strong>数据模型</strong></h3><p>新增套餐，其实就是将新增页面录入的套餐信息插入到setmeal表，还需要向setmeal_dish表插入套餐和菜品关联数据。所以在新增套餐时，涉及到两个表：</p>
<p>1、setmeal表（套餐表）</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/2.png" alt="图片"></p>
<p>2、setmeal_dish表（套餐-菜品关系表）</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/3.png" alt="图片"></p>
<h3 id="1-1-3-准备工作"><a href="#1-1-3-准备工作" class="headerlink" title="1.1.3 准备工作"></a>1.1.3 <strong>准备工作</strong></h3><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好：</p>
<p>1、实体类SetmealDish（从课程资料中导入，Setmeal实体类前面已经导入过了）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealDish</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//套餐id-和setmeal表关联</span></span><br><span class="line">    <span class="keyword">private</span> Long setmealId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品id-和dish表关联</span></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品名称-和dish表关联（冗余字段 可以没有 可以根据dish_id从dish表里现场查，也可以存在setmeal_dish表里）</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealDto</span> <span class="keyword">extends</span> <span class="title class_">Setmeal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;SetmealDish&gt; setmealDishes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//菜品原价</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//份数</span></span><br><span class="line">    <span class="keyword">private</span> Integer copies;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//排序</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>2、DTO SetmealDto（从课程资料中导入）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealDto</span> <span class="keyword">extends</span> <span class="title class_">Setmeal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;SetmealDish&gt; setmealDishes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、Mapper接口SetmealDishMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDishMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;SetmealDish&gt;&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、业务层接口SetmealDishService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDishService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;SetmealDish&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、业务层实现类SetmealDishServicelmpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SetmealMapper, Setmeal&gt; <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService setmealDishService;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、控制层SetmealController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span> <span class="comment">//@ResponseBody + @Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setmeal&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService setmealDishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-1-4-梳理交互过程及代码开发"><a href="#1-1-4-梳理交互过程及代码开发" class="headerlink" title="1.1.4 梳理交互过程及代码开发"></a>1.1.4 <strong>梳理交互过程及代码开发</strong></h3><p>在开发代码之前，需要梳理一下新增套餐时，前端页面和服务端的交互过程：</p>
<p>1、点击“新建套餐”，会请求页面backend&#x2F;page&#x2F;combo&#x2F;add.html，并发送ajax请求<code>/category/list?type=2&amp;page=1&amp;pageSize=1000</code>，请求服务端获取套餐分类数据并展示到下拉框中。此处已经在CategoryController中写过了，可以直接获取到套餐分类。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/4.png" alt="图片"></p>
<p>2、页面发送ajax请求<code>/category/list?type=1</code>，请求服务端获取菜品分类数据并展示到添加菜品窗口中。此处已经在CategoryController中写过了，可以直接获取到套餐分类。</p>
<p>3、页面发送ajax请求<code>/dish/list?categoryId=xxx(第一个菜品分类id)</code>，请求服务端，根据菜品分类，查询第一个菜品分类对应的所有菜品数据。这样一来，点击“套餐菜品：添加菜品”时，在弹出的页面内可以直接显示第一个分类的所有菜品。效果如下：</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/5.png" alt="图片"></p>
<p>并且，在“添加菜品”弹出页面内选择其他菜品分类时，也会发送请求到<code>/dish/list?categoryId=xxx(对应的菜品分类id)</code>。</p>
<p>需要服务器处理该请求，获取该分类id的所有菜品对象，并响应回来，展示菜品在页面上。</p>
<p><strong>代码开发</strong>：</p>
<p>在DishController中新增list方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据分类id, 查出该分类的所有菜品</span></span><br><span class="line"><span class="comment"> * 处理请求：/dish/list?categoryId=xxx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// select * from dish where category_id = ? AND status = ?</span></span><br><span class="line">    <span class="comment">//构造查询条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper=<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    lambdaQueryWrapper.eq(Dish::getStatus,<span class="number">1</span>); <span class="comment">//只查启售的菜品，停售(status=0)过滤掉</span></span><br><span class="line">    lambdaQueryWrapper.eq(dish.getCategoryId()!=<span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">    lambdaQueryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>该方法的返回值：由于查出的是多个菜品dish对象，所以用List集合</p>
<p>4、页面发送请求进行图片上传，请求服务端将图片保存到服务器。已经在前面写过。</p>
<p>5、页面发送请求进行图片下载，将上传的图片进行回显。已经在前面写过。</p>
<p>6、点击“保存”按钮，发送ajax请求，将套餐相关数据以json形式提交到服务端。发送请求给<code>/setmeal</code>，method&#x3D;post。需要服务器保存套餐相关数据，并返回响应。</p>
<p>“保存套餐”的实现思路：</p>
<p>json发来的数据里，有Setmeal类的属性categoryId, name, price, status, code, description, image，也有Setmeal类中没有的setmealDishes属性，所以控制器方法形参要用SetmealDto来接收，SetmealDto类中有setmealDishes属性。</p>
<p>在控制器方法中，需要做以下这些事：</p>
<p>（1）把json数据中，属于Setmeal类的属性category_id, name, price, status, code, description, image保存到setmeal表；</p>
<p>（2）保存(insert)后，由框架生成该setmeal的主键id（该套餐的id）</p>
<p>（3）把刚才自动生成的setmeal_id(setmeal表的主键id)值，逐个赋给setmealDishes对象的setmeal_id属性，就能够对应上同一套餐和多个菜品了。</p>
<p>（4）而setmeal_dish表还需要插入dish_id, name, price, copies等字段的数据，这些都由setmealDishes属性（List<SetmealDish>类型）封装，可以直接通过setmealDishService.saveBatch(setmealDishes)新增数据。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/6.png" alt="图片"></p>
<p><strong>代码开发</strong>：</p>
<p>1、在SetmealController新增save方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setmeal&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService setmealDishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;套餐信息: &#123;&#125;&quot;</span>,setmealDto);</span><br><span class="line">        setmealService.saveWithDish(setmealDto);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增套餐成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在SetmealService中新增saveWithDish方法，并在SetmealServiceImpl中实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SetmealMapper, Setmeal&gt; <span class="keyword">implements</span> <span class="title class_">SetmealService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService setmealDishService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐，同时保存与菜品的关联关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDto</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line">        <span class="comment">//先把setmeal表中需要的数据填上</span></span><br><span class="line">        <span class="comment">//将json发来的该套餐的category_id, name, price, status, code, description, image（都封装在setmealDto中）保存到setmeal表；</span></span><br><span class="line">        <span class="built_in">this</span>.save(setmealDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行save之后，框架会生成该setmeal套餐的主键id</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//将setmeal_dish表中需要的数据填上(保存套餐和菜品的关联信息)</span></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();<span class="comment">//获取传来的setmealDto中的setmealDishes属性的值</span></span><br><span class="line">				<span class="comment">//传来的各个setmealDish对象中有copies, dishId, name, price数据</span></span><br><span class="line">        <span class="comment">//所以获取到的List中的每个setmealDish对象中，只差setmeal_id和sort了。</span></span><br><span class="line">				<span class="comment">//其中setmeal_id都是刚才框架生成的套餐主键id。多个setmealDish对象共享一个套餐主键id，因为都在同一个套餐里</span></span><br><span class="line">        setmealDishes = setmealDishes.stream().map((item) -&gt;&#123; <span class="comment">//每个item是setmealDish对象</span></span><br><span class="line">            item.setSetmealId(setmealDto.getId());</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将添加了套餐id的setmealDishes 保存到setmeal_dish表中</span></span><br><span class="line">        setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-套餐分页查询"><a href="#1-2-套餐分页查询" class="headerlink" title="1.2 套餐分页查询"></a>1.2 <strong>套餐分页查询</strong></h2><h3 id="1-2-1-需求分析"><a href="#1-2-1-需求分析" class="headerlink" title="1.2.1 需求分析"></a>1.2.1 <strong>需求分析</strong></h3><p>系统中的套餐数据很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</p>
<h3 id="1-2-2-梳理交互过程"><a href="#1-2-2-梳理交互过程" class="headerlink" title="1.2.2 梳理交互过程"></a>1.2.2 <strong>梳理交互过程</strong></h3><p>在开发代码之前，需要梳理一下套餐分页查询时前端页面和服务端的交互过程：</p>
<p>1、页面(backend&#x2F;page&#x2F;combo&#x2F;list.html)发送ajax请求，将分页查询参数(page、pageSize、name)提交到服务端，获取分页数据。</p>
<p>这一步的具体过程：</p>
<p>list.html加载后执行钩子函数created()，其中执行init()方法，将page、pageSize、name赋值，并封装在params中，执行getSetmealPage(params)方法，发GET请求到<code>/setmeal/page</code> ，携带params参数，并需要服务器响应回来分页信息pageInfo。前端相关代码：</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/7.png" alt="图片"></p>
<p>2、页面发送请求，请求服务端进行图片下载，用于页面图片展示。前面已经处理过。</p>
<h3 id="1-2-3-代码开发"><a href="#1-2-3-代码开发" class="headerlink" title="1.2.3 代码开发"></a>1.2.3 <strong>代码开发</strong></h3><p>在SetmealController中新增page方法，处理1.2.2中的第1条请求即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 套餐分页查询</span></span><br><span class="line"><span class="comment"> * 处理请求/setmeal/page?page=1&amp;pageSize=10&amp;name=xxxx，并响应分页信息pageInfo给前端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span>&#123;</span><br><span class="line">    <span class="comment">//分页构造器对象</span></span><br><span class="line">    Page&lt;Setmeal&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">    Page&lt;SetmealDto&gt; setmealDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(); <span class="comment">//方法结束时，需要响应一个Page类型的分页构造器对象。</span></span><br><span class="line">    <span class="comment">// 且该对象中需含有&quot;分类名称categoryName&quot;。所以还需要构造一个SetmealDto实体对应的Page对象，否则查不到&quot;套餐分类&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//添加查询条件（模糊查询）：</span></span><br><span class="line">    queryWrapper.like(StringUtils.isNotEmpty(name), Setmeal::getName, name);</span><br><span class="line">    <span class="comment">//添加排序条件：按照Dish表里的更新时间 倒序排列，即最近更新的排在前面(orderBy)</span></span><br><span class="line">    queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">    <span class="comment">//执行分页查询（用setmealService，查setmeal表）</span></span><br><span class="line">    setmealService.page(pageInfo, queryWrapper); <span class="comment">//处理好又会封装到Page类型的pageInfo中，pageInfo中含有数据列表records、总记录数total等信息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//接下来需要改造，额外返回category_id对应的分类名categoryName</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象拷贝：setmealDtoPage构建后没有赋值，如何赋值？</span></span><br><span class="line">    <span class="comment">//（1）可以直接把 从setmeal表中查出的pageInfo各属性值 拷贝给setmealDtoPage（除records）</span></span><br><span class="line">    <span class="comment">//（2）再把records转换为SetmealDto类型的：添加上categoryName，设置给setmealDtoPage</span></span><br><span class="line">    <span class="comment">//第（1）步：</span></span><br><span class="line">    BeanUtils.copyProperties(pageInfo, setmealDtoPage, <span class="string">&quot;records&quot;</span>);<span class="comment">//不拷贝records属性（页面上的数据信息就是records，需要处理）</span></span><br><span class="line">    <span class="comment">//格式：BeanUtils.copyProperties(源, 目的, 拷贝什么属性);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//第（2）步：处理records：</span></span><br><span class="line">    List&lt;Setmeal&gt; records = pageInfo.getRecords();<span class="comment">//把pageInfo里的records部分拿出来。</span></span><br><span class="line">    <span class="comment">// 需要处理该List集合：原本是List&lt;Setmeal&gt;类型的records，不含分类名称；</span></span><br><span class="line">    <span class="comment">// 需要变成List&lt;SetmealDto&gt;类型的records，含分类名称。</span></span><br><span class="line">    <span class="comment">// 然后设置setmealDtoPage的records为新的集合list：setmealDtoPage.setRecords(list);</span></span><br><span class="line">    List&lt;SetmealDto&gt; list = records.stream().map((item)-&gt;&#123; <span class="comment">//item：遍历出的每一个菜品对象setmeal</span></span><br><span class="line">        <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line"></span><br><span class="line">        BeanUtils.copyProperties(item, setmealDto);<span class="comment">//把setmeal的普通属性 copy给 我们自己创建的setmealDto对象</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId();<span class="comment">//获取当前遍历到的 setmeal对象的 categoryId</span></span><br><span class="line">        <span class="comment">//根据id，从数据库查询分类对象，以获取分类名称</span></span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="keyword">if</span>(category != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();<span class="comment">//获取分类名称</span></span><br><span class="line">            setmealDto.setCategoryName(categoryName);<span class="comment">//把categoryName赋值给 我们自己创建的setmealDto对象的 categoryName属性</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> setmealDto;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    setmealDtoPage.setRecords(list);<span class="comment">//把加了categoryName的新list赋给setmealDtoPage的records属性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(setmealDtoPage);  <span class="comment">//响应回的数据含有&quot;分类名称&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-3-删除套餐（含批量操作）"><a href="#1-3-删除套餐（含批量操作）" class="headerlink" title="1.3 删除套餐（含批量操作）"></a>1.3 <strong>删除套餐（含批量操作）</strong></h2><h3 id="1-3-1-需求分析"><a href="#1-3-1-需求分析" class="headerlink" title="1.3.1 需求分析"></a>1.3.1 <strong>需求分析</strong></h3><p>在套餐管理列表页面，点击“删除”按钮，可以删除对应的套餐信息。也可以通过复选框选择多个套餐，点击“批量删除”按钮，一次删除多个套餐。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/8.png" alt="图片"></p>
<p>注意，对于状态为“售卖中”的套餐不能删除，需要先停售，再删除。</p>
<h3 id="1-3-2-梳理交互过程"><a href="#1-3-2-梳理交互过程" class="headerlink" title="1.3.2 梳理交互过程"></a>1.3.2 梳理交互过程</h3><p>在开发代码之前，需要梳理一下删除套餐时前端页面和服务端的交互过程：</p>
<p>1、删除单个套餐时，页面发送ajax请求，根据套餐id删除对应套餐</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/9.png" alt="图片"></p>
<p>2、删除多个套餐时，页面发送ajax请求，根据提交的多个套餐id删除对应套餐</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/10.png" alt="图片"></p>
<p>开发删除套餐功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<p>观察删除单个套餐和批量删除套餐的请求信息可以发现，两种请求的地址和请求方式都是相同的，不同的则是传递的id个数，所以在服务端可以提供一个方法来统一处理。</p>
<h3 id="1-3-3-代码开发"><a href="#1-3-3-代码开发" class="headerlink" title="1.3.3 代码开发"></a>1.3.3 <strong>代码开发</strong></h3><p>需要服务器对请求进行处理，从数据库中删除id对应的套餐，并响应回前端。</p>
<p>在SetmealController中新增delete方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除套餐（支持批量）</span></span><br><span class="line"><span class="comment"> * 处理请求/setmeal?ids=xxx</span></span><br><span class="line"><span class="comment"> * 注意：只能删除停售(status=0)的套餐，启售(status=1)的套餐不能删除</span></span><br><span class="line"><span class="comment"> * 所以要先判断套餐的status，如果为0，执行删除。如果为1，返回提示信息</span></span><br><span class="line"><span class="comment"> * 同时还要删除setmeal_dish表中 该套餐对应的信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(String[] ids)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//计数：ids中有多少个启售的套餐</span></span><br><span class="line">    <span class="keyword">for</span>(String id : ids)&#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealService.getById(id);</span><br><span class="line">        <span class="keyword">if</span>(setmeal.getStatus() == <span class="number">0</span>)&#123; <span class="comment">//停售(status=0)的套餐</span></span><br><span class="line">            <span class="comment">//删除setmeal表中的停售套餐</span></span><br><span class="line">            setmealService.removeById(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//同时还要删除setmeal_dish表中 该套餐对应的信息（这一段老师未写，自己改的）</span></span><br><span class="line">            <span class="comment">// select * from setmeal_dish where setmeal_id = ?</span></span><br><span class="line">            LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(SetmealDish::getSetmealId, id);</span><br><span class="line">            setmealDishService.remove(queryWrapper);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//启售(status=1)的套餐</span></span><br><span class="line">            count++; <span class="comment">//启售的套餐数量加1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(count &gt; <span class="number">0</span> &amp;&amp; count == ids.length)&#123; <span class="comment">//全是启售的</span></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;选中的套餐均为&#x27;启售&#x27;状态，不可删除&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; <span class="comment">//如果有至少1个套餐是停售的，删除了选中的停售套餐</span></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;套餐删除成功&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-4-启售-x2F-停售套餐（含批量操作）"><a href="#1-4-启售-x2F-停售套餐（含批量操作）" class="headerlink" title="1.4 启售&#x2F;停售套餐（含批量操作）"></a>1.4 启售&#x2F;停售<strong>套餐（含批量操作）</strong></h2><p>这一节为自己补充实现的功能，经测试暂未发现问题，可供参考。如有问题欢迎讨论。</p>
<h3 id="1-4-1-需求分析"><a href="#1-4-1-需求分析" class="headerlink" title="1.4.1 需求分析"></a>1.4.1 <strong>需求分析</strong></h3><p>点“启售&#x2F;停售”，或者选中多个勾选框后，点击“批量启售&#x2F;批量停售”，并点击“确认”后，发送&#x2F;setmeal&#x2F;status&#x2F;0?ids&#x3D;xxx到服务器，需要服务器处理。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/11.png" alt="图片"></p>
<p>服务器需要先根据id找到该套餐，再更改setmeal实体对象的status，然后用实体更新setmeal表中的数据。</p>
<h3 id="1-4-2-代码开发"><a href="#1-4-2-代码开发" class="headerlink" title="1.4.2 代码开发"></a>1.4.2 <strong>代码开发</strong></h3><p>在SetmealController中新增switchStatus方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启售停售切换（支持批量）处理/setmeal/status/0?ids=xxx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">switchStatus</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, String[] ids)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (String id : ids)&#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealService.getById(id);</span><br><span class="line">        setmeal.setStatus(status);</span><br><span class="line">        setmealService.updateById(setmeal);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;状态修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-5-修改套餐"><a href="#1-5-修改套餐" class="headerlink" title="1.5 修改套餐"></a>1.5 <strong>修改套餐</strong></h2><p>这一节为自己补充实现的功能，经测试暂未发现问题，可供参考。如有问题欢迎讨论。</p>
<h3 id="1-5-1-需求分析"><a href="#1-5-1-需求分析" class="headerlink" title="1.5.1 需求分析"></a>1.5.1 <strong>需求分析</strong></h3><p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/12.png" alt="图片"></p>
<p>在套餐管理列表页面的某套餐一行，点击”修改”按钮，请求&#x2F;backend&#x2F;page&#x2F;combo&#x2F;add.html?id&#x3D;xxx，跳转到修改套餐页面。需要服务端在该页面回显该套餐信息。用户进行修改后点击“确定”按钮，完成修改操作。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/13.png" alt="图片"></p>
<h3 id="1-5-2-梳理交互过程"><a href="#1-5-2-梳理交互过程" class="headerlink" title="1.5.2 梳理交互过程"></a>1.5.2 <strong>梳理交互过程</strong></h3><p>在开发代码之前，需要梳理一下修改套餐时，前端页面和服务端的交互过程：</p>
<p>1、在list.html页面点击“修改”，执行addSetMeal(scope.row.id)方法，请求<code>/backend/page/combo/add.html?id=xxxx</code>页面，其中id是要修改的这一行套餐的id。</p>
<p>2、在add.html页面加载完成后，执行钩子函数，并执行getDishTypeList()方法，请求<code>/category/list?type=2&amp;page=1&amp;pageSize=1000</code>，method&#x3D;get，请求获取所有的套餐分类（商务套餐&#x2F;儿童套餐）。在前面已经写过，此处可以直接获取到。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/14.png" alt="图片"></p>
<p>3、在add.html页面加载完成后，执行钩子函数，并执行getDishType()方法，请求<code>/category/list?type=1</code>，method&#x3D;get，获取“+添加菜品”按钮处要显示的所有的菜品分类。在前面已经写过，此处可以直接获取到。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/15.png" alt="图片"></p>
<p>4、在add.html页面加载完成后，执行钩子函数（见第2步后的图）。由于url中有id，所以执行init()方法，其中执行querySetmealById(this.id)方法，请求<code>/setmeal/套餐id</code>，请求方式GET，获取套餐信息以回显到页面。</p>
<p>需要服务器查询，并响应该套餐id的name, price, categoryName（第3步已经获取到所有的category对象）, status, categoryId, setmealDishes, image, description等信息，封装到data中传回前端，以回显到修改页面上。</p>
<p>5、同时请求<code>/dish/list?categoryId=xxxx</code>，获取“+添加菜品”按钮处要显示的某分类的所有菜品。已经写过。</p>
<p>6、同时请求服务端进行图片下载，用于页图片回显。已经写过。</p>
<p>7、填写表单后，点击“保存”，发送json请求给<code>/setmeal</code>，请求方式PUT。需要服务器处理，将修改后的信息保存到数据表。</p>
<h3 id="1-5-3-代码开发"><a href="#1-5-3-代码开发" class="headerlink" title="1.5.3 代码开发"></a>1.5.3 <strong>代码开发</strong></h3><p>我们需要处理1.5.2中的第4条和第7条的请求，其余的已经写过。</p>
<p>1、（对应1.5.2中第4条）修改页面的信息回显：</p>
<p>处理请求<code>/setmeal/1633386599796461569</code>，路径参数是套餐的id。</p>
<p>服务端需要将该套餐id对应的name, price, categoryName（1.5.2的第3条中已经获取到）, setmealDishes, image, description等信息响应给前端。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/16.png" alt="图片"></p>
<p>SetmealController中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改某个套餐时，需要回显该套餐id的信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;SetmealDto&gt; <span class="title function_">querySetmeal</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123; <span class="comment">//此处id是套餐的id</span></span><br><span class="line">    <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> setmealService.getByIdWithDish(id);</span><br><span class="line">    <span class="keyword">return</span> R.success(setmealDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SetmealService中添加getByIdWithDish方法，并在SetmealServiceImpl中实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id，查询套餐（含套餐内的菜品）</span></span><br><span class="line"><span class="comment"> * 需要响应给前端的：</span></span><br><span class="line"><span class="comment"> * 套餐id, 套餐分类categoryId, 套餐name, 套餐价格price, 套餐状态status, code, description, image, 公共字段 ————都包含在setmeal对象中</span></span><br><span class="line"><span class="comment"> * 和setmealDishes（集合，盛装多个setmealDish对象，其中含有id, setmealId, 菜品dishId, 菜品name, 菜品price, copies, sort, 公共字段）————需由setmealDto对象来盛装</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 套餐setmeal的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> SetmealDto <span class="title function_">getByIdWithDish</span><span class="params">(Long id)</span> &#123; <span class="comment">//此处的id，在setmeal表中，是id；在setmeal_dish表中，是setmeal_id</span></span><br><span class="line">    <span class="comment">//查询套餐基本信息</span></span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);<span class="comment">//在setmeal表中，根据id查出套餐</span></span><br><span class="line">    <span class="comment">//包含的字段：套餐的id, 套餐分类categoryId, 套餐name, 套餐价格price, 套餐状态status, code, description, image, 公共字段</span></span><br><span class="line"></span><br><span class="line">    <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line">    BeanUtils.copyProperties(setmeal, setmealDto);</span><br><span class="line">    <span class="comment">//copy后，setmealDto中还差setmealDishes属性。可以去setmeal_dish表中，根据setmeal_id查出相应的多个setmeal_dish对象，组成集合</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//select * from setmeal_dish where setmeal_id = ?</span></span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(SetmealDish::getSetmealId, id); <span class="comment">//查出该套餐(setmeal_id)中的多个setmeal_dish对象</span></span><br><span class="line">    List&lt;SetmealDish&gt; list = setmealDishService.list(queryWrapper);<span class="comment">//将查出的多个结果组成集合</span></span><br><span class="line">    setmealDto.setSetmealDishes(list); <span class="comment">//将集合list赋给setmealDto中空缺的setmealDishes属性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> setmealDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、（对应前端第7条）将修改后的信息保存到数据表</p>
<p>填写表单后，点击“保存”，发送json请求给<code>/setmeal</code>，请求方式PUT。需要服务器处理，将新的信息更新到数据表。更新仍然使用先删除再修改的方法，需要补充setmeal_id，才能和套餐对应上。</p>
<p>SetmealController中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改套餐信息</span></span><br><span class="line"><span class="comment"> * 处理json请求/setmeal，请求方式PUT。</span></span><br><span class="line"><span class="comment"> * 需要服务器将新的信息保存到数据表。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span>&#123;</span><br><span class="line">    setmealService.updateWithDish(setmealDto);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SetmealService中添加getByIdWithDish方法，并在SetmealServiceImpl中实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改套餐信息setmeal，并更新套餐包含的菜品(setmeal_dishes)</span></span><br><span class="line"><span class="comment"> * 需要把setmealDto的数据更新到setmeal表和setmeal_dish表中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmealDto</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line">    <span class="comment">//更新setmeal表的基本信息</span></span><br><span class="line">    <span class="built_in">this</span>.updateById(setmealDto); <span class="comment">//通过setmealService的updateById方法，将setmealDto封装的数据更新到setmeal表</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//现在还需要把setmealDto中的setmealDishes部分（List&lt;SetmealDish&gt;），更新到setmeal_dish表中</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新setmeal_dish表信息:先delete，再insert</span></span><br><span class="line">    <span class="comment">//(1) delete: delete from setmeal_dish where setmeal_id = ?</span></span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(SetmealDish::getSetmealId, setmealDto.getId());<span class="comment">//setmealDto.getId()就是当前套餐setmeal的id，在setmeal表中是id字段，在setmeal_dish表中是setmeal_id字段</span></span><br><span class="line">    setmealDishService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2) insert：将setmealDto的setmealDishes中的数据 重新插入setmeal_dish表中</span></span><br><span class="line">    <span class="comment">// 将setmeal_id添加进setmealDto中的一个个setmealDishes对象中，关联上</span></span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line"></span><br><span class="line">    setmealDishes = setmealDishes.stream().map((item) -&gt; &#123;<span class="comment">//每个item就是一个setmealDish对象，一个套餐的setmealDishes中有多个setmealDish对象</span></span><br><span class="line">        item.setSetmealId(setmealDto.getId());</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    setmealDishService.saveBatch(setmealDishes);<span class="comment">//将setmealDto中的setmealDishes部分，更新到setmeal_dish表中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-手机验证码登录"><a href="#2-手机验证码登录" class="headerlink" title="2. 手机验证码登录"></a>2. <strong>手机验证码登录</strong></h1><h2 id="2-1-短信发送"><a href="#2-1-短信发送" class="headerlink" title="2.1 短信发送"></a>2.1 <strong>短信发送</strong></h2><h3 id="2-1-1-短信服务介绍"><a href="#2-1-1-短信服务介绍" class="headerlink" title="2.1.1 短信服务介绍"></a>2.1.1 <strong>短信服务介绍</strong></h3><p>目前市面上有很多第三方提供的短信服务，这些第三方短信服务会和各个运营商（移动、联通、电信)对接，我们只需要注册成为会员并且按照提供的开发文档进行调用就可以发送短信。需要说明的是，这些短信服务一般都是收费服务。</p>
<p>常用短信服务:</p>
<ul>
<li>阿里云</li>
<li>华为云</li>
<li>腾讯云</li>
<li>京东</li>
<li>梦网</li>
<li>乐信</li>
</ul>
<h3 id="2-1-2-阿里云短信服务-介绍"><a href="#2-1-2-阿里云短信服务-介绍" class="headerlink" title="2.1.2 阿里云短信服务-介绍"></a>2.1.2 <strong>阿里云短信服务-介绍</strong></h3><p>阿里云短信服务(Short Message Service)是广大企业客户快速触达手机用户所优选使用的通信能力。调用API或用群发助手，即可发送验证码、通知类和营销类短信;国内验证短信秒级触达，到达率最高可达99%;国际&#x2F;港澳台短信覆盖200多个国家和地区，安全稳定，广受出海企业选用。</p>
<p>应用场景:</p>
<ul>
<li>验证码</li>
<li>短信通知</li>
<li>推广短信</li>
</ul>
<h3 id="2-1-3-阿里云短信服务-注册账号"><a href="#2-1-3-阿里云短信服务-注册账号" class="headerlink" title="2.1.3 阿里云短信服务-注册账号"></a>2.1.3 <strong>阿里云短信服务-注册账号</strong></h3><p>阿里云官网： <a target="_blank" rel="noopener" href="https://www.aliyun.com/">https://www.aliyun.com/</a></p>
<p>在官网首页进行注册。</p>
<h3 id="2-1-4-阿里云短信服务-设置短信签名"><a href="#2-1-4-阿里云短信服务-设置短信签名" class="headerlink" title="2.1.4 阿里云短信服务-设置短信签名"></a>2.1.4 <strong>阿里云短信服务-设置短信签名</strong></h3><p>注册成功后，点击登录按钮进行登录。登录后进入短信服务管理页面，选择国内消息菜单。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/17.png" alt="图片"></p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/18.png" alt="图片"></p>
<p>短信签名是短信发送者的署名，表示发送方的身份。</p>
<h3 id="2-1-5-阿里云短信服务-设置短信模板"><a href="#2-1-5-阿里云短信服务-设置短信模板" class="headerlink" title="2.1.5 阿里云短信服务-设置短信模板"></a>2.1.5 <strong>阿里云短信服务-设置短信模板</strong></h3><p>切换到【模板管理】标签页:</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/19.png" alt="图片"></p>
<p>短信模板包含短信发送内容、场景、变量信息。</p>
<h3 id="2-1-6-阿里云短信服务-设置AccessKey"><a href="#2-1-6-阿里云短信服务-设置AccessKey" class="headerlink" title="2.1.6 阿里云短信服务-设置AccessKey"></a>2.1.6 <strong>阿里云短信服务-设置AccessKey</strong></h3><p>1、光标移动到用户头像上，在弹出的窗口中点击【AccessKey管理】∶</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/20.png" alt="图片"></p>
<p>2、点击“开始使用子用户AccessKey”（非管理员的权限，更安全）</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/21.png" alt="图片"></p>
<p>3、创建用户：创建用户-填写登录名、显示名-勾选“编程访问”-会生成AccessKey ID &amp; AccessKey Secret，复制存起来。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/22.png" alt="图片"></p>
<p>4、设置权限：点击刚创建的用户-权限管理-添加权限-搜索“SMS“，选择“AliyunDysmsFullAccess”和“AliyunDysmsReadOnlyAccess”两个权限</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/23.png" alt="图片"></p>
<h3 id="2-1-7-代码开发"><a href="#2-1-7-代码开发" class="headerlink" title="2.1.7 代码开发"></a>2.1.7 <strong>代码开发</strong></h3><p>使用阿里云短信服务发送短信，可以参照官方提供的文档即可。</p>
<p>具体开发步骤：</p>
<p>1、导入maven坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--阿里云短信 用于手机验证码登录--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、调用API（此处暂时了解即可，老师暂时没有用短信验证，是使用控制台进行验证的）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 短信发送工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送短信</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> signName 签名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> templateCode 模板</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> phoneNumbers 手机号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> param 参数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String signName, String templateCode,String phoneNumbers,String param)</span>&#123;</span><br><span class="line">		<span class="type">DefaultProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(<span class="string">&quot;cn-hangzhou&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);<span class="comment">//此处需要填入access key id和secret</span></span><br><span class="line">		<span class="type">IAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line"></span><br><span class="line">		<span class="type">SendSmsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">		request.setSysRegionId(<span class="string">&quot;cn-hangzhou&quot;</span>);</span><br><span class="line">		request.setPhoneNumbers(phoneNumbers);</span><br><span class="line">		request.setSignName(signName);</span><br><span class="line">		request.setTemplateCode(templateCode);</span><br><span class="line">		request.setTemplateParam(<span class="string">&quot;&#123;\\&quot;</span>code\\<span class="string">&quot;:\\&quot;</span><span class="string">&quot;+param+&quot;</span>\\<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">SendSmsResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.getAcsResponse(request);</span><br><span class="line">			System.out.println(<span class="string">&quot;短信发送成功&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-手机验证码登录"><a href="#2-2-手机验证码登录" class="headerlink" title="2.2 手机验证码登录"></a>2.2 <strong>手机验证码登录</strong></h2><h3 id="2-2-1-需求分析"><a href="#2-2-1-需求分析" class="headerlink" title="2.2.1 需求分析"></a>2.2.1 <strong>需求分析</strong></h3><p>为了方便用户登录，移动端通常都会提供通过手机验证码登录的功能。</p>
<p>手机验证码登录的优点：</p>
<ul>
<li>方便快捷，无需注册，直接登录</li>
<li>使用短信验证码作为登录凭证，无需记忆密码</li>
<li>安全</li>
</ul>
<p>登录流程：</p>
<p>输入手机号&gt;获取验证码&gt;输入验证码&gt;点击登录&gt;登录成功</p>
<p>注意：通过手机验证码登录，手机号是区分不同用户的标识。</p>
<h3 id="2-2-2-数据模型"><a href="#2-2-2-数据模型" class="headerlink" title="2.2.2 数据模型"></a>2.2.2 <strong>数据模型</strong></h3><p>通过手机验证码登录时，涉及的表为user表，即用户表。结构如下:</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/24.png" alt="图片"></p>
<h3 id="2-2-3-梳理交互过程"><a href="#2-2-3-梳理交互过程" class="headerlink" title="2.2.3 梳理交互过程"></a>2.2.3 梳理交互过程</h3><p>在开发代码之前，需要梳理一下登录时前端页面和服务端的交互过程：</p>
<p>1、在登录页面(front&#x2F;page&#x2F;login.html)输入手机号，点击【获取验证码】按钮，执行getCode()方法，页面发送ajax请求<code>/user/sendMsg</code>，method&#x3D;post，在服务端调用短信服务API给指定手机号发送验证码短信。</p>
<p>2、在登录页面输入验证码，点击【登录】按钮，执行btnLogin({phone:this.form.phone})方法，发送ajax请求<code>/user/login</code>，method&#x3D;post，服务端需要处理登录请求。</p>
<p>如果服务端响应回来登录成功，则跳转到<code>/front/index.html</code>。</p>
<h3 id="2-2-4-准备工作"><a href="#2-2-4-准备工作" class="headerlink" title="2.2.4 准备工作"></a>2.2.4 准备工作</h3><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p>
<p>1、实体类User(直接从课程资料中导入即可)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//姓名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//手机号</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//性别 0 女 1 男</span></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//身份证号</span></span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//头像</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//状态 0:禁用，1:正常</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、Mapper接口UserMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、Service接口UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、Service实现类UserServicelmpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、控制层UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、工具类SMSutils、 ValidateCodeutils（直接从课程资料中导入即可)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 短信发送工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送短信</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> signName 签名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> templateCode 模板</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> phoneNumbers 手机号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> param 参数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String signName, String templateCode,String phoneNumbers,String param)</span>&#123;</span><br><span class="line">		<span class="type">DefaultProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(<span class="string">&quot;cn-hangzhou&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//此处需要填入access key id和secret</span></span><br><span class="line">		<span class="type">IAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line"></span><br><span class="line">		<span class="type">SendSmsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">		request.setSysRegionId(<span class="string">&quot;cn-hangzhou&quot;</span>);</span><br><span class="line">		request.setPhoneNumbers(phoneNumbers);</span><br><span class="line">		request.setSignName(signName);</span><br><span class="line">		request.setTemplateCode(templateCode);</span><br><span class="line">		request.setTemplateParam(<span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span>+param+<span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">SendSmsResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.getAcsResponse(request);</span><br><span class="line">			System.out.println(<span class="string">&quot;短信发送成功&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随机生成验证码工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidateCodeUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度为4位或者6位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">generateValidateCode</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(length == <span class="number">4</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">9999</span>);<span class="comment">//生成随机数，最大为9999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">1000</span>;<span class="comment">//保证随机数为4位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(length == <span class="number">6</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">999999</span>);<span class="comment">//生成随机数，最大为999999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">100000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">100000</span>;<span class="comment">//保证随机数为6位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;只能生成4位或6位数字验证码&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成指定长度字符串验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateValidateCode4String</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rdm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">hash1</span> <span class="operator">=</span> Integer.toHexString(rdm.nextInt());</span><br><span class="line">        <span class="type">String</span> <span class="variable">capstr</span> <span class="operator">=</span> hash1.substring(<span class="number">0</span>, length);</span><br><span class="line">        <span class="keyword">return</span> capstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-5-代码开发"><a href="#2-2-5-代码开发" class="headerlink" title="2.2.5 代码开发"></a>2.2.5 <strong>代码开发</strong></h3><p>1、修改过滤器</p>
<p>前面我们已经完成了LoginCheckFilter过滤器的开发，此过滤器用于检查用户的登录状态。我们在进行手机验证码登录时，发送的请求需要在此过滤器处理时直接放行。</p>
<p><img src="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9605-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/25.png" alt="图片"></p>
<p>LoginCheckFilter过滤器添加4-2部分，完整的LoginCheckFilter过滤器如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> LoginCheckFilter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 登录检查过滤器（也可以用拦截器interceptor实现，此项目中用过滤器实现）</span></span><br><span class="line"><span class="comment"> * 检查用户是否已经完成登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;, urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="comment">//@WebFilter替代web.xml配置过滤器。filterName指定过滤器名称（随意）；urlPatterns指定拦截的请求：/* 工程路径下所有的请求都拦截</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//路径匹配器，支持通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();<span class="comment">//专门用于路径比较</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、获取本次请求的URI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        log.info(<span class="string">&quot;拦截到请求：&#123;&#125;&quot;</span>, requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、判断本次请求是否需要处理</span></span><br><span class="line">        <span class="comment">//不需要处理的请求路径：</span></span><br><span class="line">        String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                <span class="string">&quot;/employee/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span>,  <span class="comment">// /backend下的页面、静态资源其实可以看，但是不给看页面上的数据（动态请求）</span></span><br><span class="line">                <span class="string">&quot;/front/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/user/sendMsg&quot;</span>, <span class="comment">//移动端 发送验证短信</span></span><br><span class="line">                <span class="string">&quot;/user/login&quot;</span> <span class="comment">//移动端 登录</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> check(urls, requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、如果不需要处理，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(check)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;本次请求&#123;&#125;无需处理&quot;</span>, requestURI); <span class="comment">// &#123;&#125;是占位符，由后面的参数填充</span></span><br><span class="line">            chain.doFilter(request, response);  <span class="comment">//放行</span></span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">//放行之后，后面代码不需要执行了，直接return结束</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4-1、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line">        <span class="comment">// 并且把登录用户的id拿到，放到threadLocal中</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="keyword">if</span>(session.getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;  <span class="comment">//判断后台员工登录状态</span></span><br><span class="line">            <span class="comment">//已登录</span></span><br><span class="line">            log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>, session.getAttribute(<span class="string">&quot;employee&quot;</span>)); <span class="comment">//session中，&quot;employee&quot;记录的是登录用户的id</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            为了实现&quot;公共字段自动填充&quot;功能。</span></span><br><span class="line"><span class="comment">            我们可以在LoginCheckFilter的doFilter方法中获取当前登录用户id，</span></span><br><span class="line"><span class="comment">            并调用ThreadLocal的set方法来设置当前线程的线程局部变量的值（用户id)，</span></span><br><span class="line"><span class="comment">            然后在MyMetaObjectHandler的updateFill方法中调用ThreadLocal的get方法来获得当前线程所对应的线程局部变量的值(用户id)</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) session.getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">            BaseContext.setCurrentId(empId);  </span><br><span class="line">            chain.doFilter(request, response);  <span class="comment">//放行</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4-2、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line">        <span class="comment">// 并且把登录用户的id拿到，放到threadLocal中</span></span><br><span class="line">        <span class="comment">//此处有bug：如果用户登录了，也可以进入管理后台。后期可以优化</span></span><br><span class="line">        <span class="keyword">if</span>(session.getAttribute(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>)&#123;  <span class="comment">//判断前台用户登录状态</span></span><br><span class="line">            <span class="comment">//已登录</span></span><br><span class="line">            log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>, session.getAttribute(<span class="string">&quot;employee&quot;</span>)); <span class="comment">//session中，&quot;employee&quot;记录的是登录用户的id</span></span><br><span class="line">            </span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            BaseContext.setCurrentId(userId); </span><br><span class="line">            chain.doFilter(request, response);  <span class="comment">//放行</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//5、如果未登录 向浏览器响应数据 返回未登录结果</span></span><br><span class="line">            log.info(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">            response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">            <span class="comment">//通过输出流向浏览器响应数据，给R.error传回msg ——&quot;NOTLOGIN&quot;。</span></span><br><span class="line">            <span class="comment">//在request.js页面的前端响应拦截器处，会拦截服务器给的响应。如果code==0，且msg显示NOTLOGIN，说明用户未登录，会跳转到登录页面</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">//不放行，结束方法</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查本次请求是否需要放行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urls</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestURI</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls, String requestURI)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String url : urls)&#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span>(match)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//匹配上了</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//匹配不上</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、前端资源</p>
<p>资料&#x2F;前端资源&#x2F;front部分代码不全，建议直接拷贝资料中的day05的front资源。</p>
<p>或者也可以按如下步骤手动修改：</p>
<p>(1)修改&#x2F;front&#x2F;api&#x2F;login.js中内容，新增：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sendMsgApi</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $axios(&#123;</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;/user/sendMsg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2)修改&#x2F;front&#x2F;page&#x2F;login.html中getCode()方法：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this.form.code = (Math.random()*1000000).toFixed(0)</span></span><br><span class="line"><span class="title function_">sendMsgApi</span>(&#123;<span class="attr">phone</span>:<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>3、UserController中新增方法，处理发送验证码的请求</p>
<p>处理请求&#x2F;user&#x2F;sendMsg，生成验证码code，在IDEA的console显示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发送手机短信验证码</span></span><br><span class="line"><span class="comment"> * 用户点&quot;获取验证码&quot;后，处理ajax请求/user/sendMsg，data为phone电话号</span></span><br><span class="line"><span class="comment"> * 参数：可以用String phone接收，此处用更大的User user接收，含有同名的phone参数。通用性更强</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//获取手机号</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotEmpty(phone))&#123; <span class="comment">//判断填写的手机号非空</span></span><br><span class="line">        <span class="comment">//生成随机4位验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br><span class="line">        log.info(<span class="string">&quot;code = &#123;&#125;&quot;</span>, code); <span class="comment">//可以在IDEA的console显示</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用阿里云提供的短信服务API，发送验证码短信。为了隐私，以及因为测试专用模板只能使用固定的4-6位纯数字，变量传不进去，所以这里不发短信，只在控制台模拟，自己看code填写</span></span><br><span class="line">        <span class="comment">//SMSUtils.sendMessage(code);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//将生成的验证码保存到session，一会进行校验</span></span><br><span class="line">        session.setAttribute(phone, code); <span class="comment">//以手机号的string形式为键，验证码为值</span></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;手机验证码短信发送成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;手机短信发送失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、在UserController新增login方法，处理登录请求</p>
<p>目标：处理请求&#x2F;user&#x2F;login。</p>
<p>思路：验证用户填写的phone对应的code，是否是服务器(sendMsg方法)刚才生成的code。如果是，则登录成功，向session中保存该user的id。如果不一致，则登录失败。如果数据库中不存在该手机号，则会重新注册。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移动端用户登录</span></span><br><span class="line"><span class="comment"> * 前端带着参数code &amp; phone，请求/user/login</span></span><br><span class="line"><span class="comment"> * 参数可以用UserDto（其中扩展了String code属性）。也可以声明Map类型的map。</span></span><br><span class="line"><span class="comment"> * 参数传来的是json形式：&#123;phone=13444433333, code=1233&#125;，服务器通过在形参中使用<span class="doctag">@RequestBody</span>注解，可以获取json格式的请求参数（map）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; map, HttpSession session)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;map: &#123;&#125;&quot;</span>, map.toString());</span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>); <span class="comment">//获取手机号</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>); <span class="comment">//获取验证码</span></span><br><span class="line">    <span class="comment">//从session中获取 sendMsg()中保存的 该手机号对应的验证码</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> session.getAttribute(phone);</span><br><span class="line">    <span class="comment">//进行验证码比对（页面提交的验证码和Session中保存的验证码比对）</span></span><br><span class="line">    <span class="keyword">if</span>(codeInSession != <span class="literal">null</span> &amp;&amp; codeInSession.equals(code))&#123;</span><br><span class="line">        <span class="comment">//如果能比对成功，登录成功。则需要将用户的id放进session。</span></span><br><span class="line">        <span class="comment">//如果验证码填写正确，但是没有此用户，则说明是新用户，需要注册。</span></span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getPhone, phone);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//新用户，需要注册</span></span><br><span class="line">            user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setPhone(phone);</span><br><span class="line">            user.setStatus(<span class="number">1</span>); <span class="comment">//状态 0:禁用，1:正常</span></span><br><span class="line">            userService.save(user);</span><br><span class="line">        &#125;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;user&quot;</span>, user.getId());</span><br><span class="line">        <span class="keyword">return</span> R.success(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>补充：老师示范的代码没有保存用户名，所以用户名在user表中为null。后续下单后，在后台“订单明细”页面会看不到用户名。此处可以完善一下，修改login()方法的代码，将新用户注册部分改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;<span class="comment">//当前phone不在user表中，查不到该phone，说明当前登录的是新用户，需要自动注册</span></span><br><span class="line">    user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setPhone(phone);</span><br><span class="line">    user.setStatus(<span class="number">1</span>); <span class="comment">//状态 0:禁用，1:正常</span></span><br><span class="line">    <span class="comment">//新加代码：目的是在注册时，给user表的name字段赋值为：&quot;用户&quot;+userId的后六位</span></span><br><span class="line">    log.info(<span class="string">&quot;user_id为：&#123;&#125;&quot;</span>, user.getId());</span><br><span class="line">    user.setId(IdWorker.getId());</span><br><span class="line">    user.setName(<span class="string">&quot;用户&quot;</span> + (user.getId() + <span class="number">1000000L</span>) % <span class="number">1000000L</span>);<span class="comment">//假如倒数第六位是0，需要保证结果是六位数，可以在取模前先扩展到至少六位数。</span></span><br><span class="line">    userService.save(user);<span class="comment">//设置用户名后，再保存该用户到user表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SpringBoot/" rel="tag"># SpringBoot</a>
              <a href="/tags/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" rel="tag"># 项目笔记</a>
              <a href="/tags/java/" rel="tag"># java</a>
              <a href="/tags/MySQL/" rel="tag"># MySQL</a>
              <a href="/tags/Spring/" rel="tag"># Spring</a>
              <a href="/tags/Spring-MVC/" rel="tag"># Spring MVC</a>
              <a href="/tags/MyBatis/" rel="tag"># MyBatis</a>
              <a href="/tags/html/" rel="tag"># html</a>
              <a href="/tags/javascript/" rel="tag"># javascript</a>
              <a href="/tags/DTO/" rel="tag"># DTO</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9604-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/" rel="prev" title="瑞吉外卖04-菜品管理">
                  <i class="fa fa-chevron-left"></i> 瑞吉外卖04-菜品管理
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/05/13/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%9606-%E7%94%A8%E6%88%B7%E7%AB%AF-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E8%AE%A2%E5%8D%95/" rel="next" title="瑞吉外卖06-用户端+管理后台订单">
                  瑞吉外卖06-用户端+管理后台订单 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kathy-kx</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
